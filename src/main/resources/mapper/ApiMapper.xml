<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.ApiDao">

	<select id="getDeviceList"
		resultType="com.example.demo.dto.ApiDeviceControllVO">

		SELECT
		DEVICE_ID,
		DEVICE_NAME
		FROM
		tb_device_info;

	</select>

	<insert id="saveDevice"
		parameterType="com.example.demo.dto.ApiDeviceControllVO">

		INSERT INTO
		tb_device_info(
		DEVICE_ID,
		DEVICE_NAME

		)VALUES (
		#{deviceId},
		#{deviceName}
		)
	</insert>

	<update id="updateDevice"
		parameterType="com.example.demo.dto.ApiDeviceControllVO">

		UPDATE tb_device_info
		SET
		DEVICE_NAME = #{deviceName}
		WHERE
		DEVICE_ID = #{deviceId};

	</update>

	<select id="chkDeviceId" resultType="String">

		SELECT
		DEVICE_ID
		FROM
		tb_device_info
		WHERE
		DEVICE_ID = #{deviceId};

	</select>

	<delete id="delPerDate"
		parameterType="com.example.demo.dto.ApiDeviceControllVO">

		DELETE FROM tb_count_per_day
		WHERE
		DEVICE_ID =
		#{deviceId};

	</delete>

	<delete id="delDevice"
		parameterType="com.example.demo.dto.ApiDeviceControllVO">

		DELETE FROM tb_device_info
		WHERE
		DEVICE_ID = #{deviceId};

	</delete>

	<select id="currentCount"
		parameterType="com.example.demo.dto.ApiTagCountVO"
		resultType="com.example.demo.dto.ApiTagCountVO">

		SELECT
		LOCATION,
		COUNT
		FROM
		tb_device_current_count
		WHERE
		DEVICE_ID = #{deviceId};

	</select>

	<select id="getColRowNum"
		resultType="com.example.demo.dto.ApiColRowNumVO">

		SELECT
		COL_NUM,
		ROW_NUM
		FROM
		tb_device_info
		WHERE
		DEVICE_ID =
		#{deviceId};

	</select>

	<!-- <insert id="regTag" parameterType="com.example.demo.dto.ApiTagRegVO"> 
		INSERT INTO tb_item_info( TAG, ITEM_CODE, ITEM_NAME )VALUES ( #{tag}, #{itemCode}, 
		#{itemName} ) </insert> -->

	<insert id="regTag"
		parameterType="com.example.demo.dto.ApiTagRegVO">

		INSERT INTO
		tb_item_info(
		TAG,
		ITEM_CODE,
		ITEM_NAME,
		ITEM_GROUP,
		ITEM_STANDARD,
		ITEM_ADMIN,
		ITEM_DEPART,
		ITEM_SITE,
		ITEM_ROOM,
		ITEM_GET_DATE,
		ITEM_GET_PRICE,
		ITEM_NOTE

		)VALUES (
		#{tag},
		#{itemCode},
		#{itemName},
		#{itemGroup},
		#{itemStandard},
		#{itemAdmin},
		#{itemDepart},
		#{itemSite},
		#{itemRoom},
		#{itemGetDate},
		#{itemGetPrice},
		#{itemNote}
		)
	</insert>

	<select id="searchCode"
		parameterType="com.example.demo.dto.tagSearchVO">

		SELECT A.TAG,
		B.ITEM_NAME,
		C.DATE_TIME
		AS INPUT_DATE_TIME
		FROM
		tb_tag_current_location A
		LEFT
		JOIN
		tb_item_info B
		ON A.TAG = B.TAG
		LEFT
		JOIN tb_tag_input_history C
		ON A.TAG
		= C.TAG
		WHERE B.ITEM_CODE =
		#{searchCode}
		ORDER BY
		C.DATE_TIME DESC LIMIT
		1;

	</select>

	<select id="getCheckRowTag"
		parameterType="com.example.demo.dto.ApiDeviceControllVO">
		SELECT
		A.TAG,
		B.ITEM_NAME,
		C.DATE_TIME
		AS INPUT_TAG_TIME
		FROM
		tb_tag_current_location A
		LEFT
		JOIN tb_item_info B
		ON A.TAG = B.TAG
		LEFT
		JOIN tb_tag_input_history C
		ON A.TAG = C.TAG
		<if test="chkRowTagArr != null and chkRowTagArr != ''">
			WHERE A.TAG IN(
			<foreach collection="chkRowTagArr" item="chkRowTagArr"
				separator=",">
				#{chkRowTagArr}
			</foreach>
			)
		</if>
		ORDER BY
		C.DATE_TIME DESC LIMIT 1
	</select>


	<!-- 여기부터 고쳐야됨 -->
	<select id="getItemSearch"
		resultType="com.example.demo.dto.ApiDeviceControllVO">
		SELECT A.TAG,
		B.COMPANY_ID,
		B.ITEM_NAME
		FROM
		tb_tag_current_location A
		LEFT JOIN tb_item_info B
		ON A.TAG = B.TAG
		LEFT JOIN tb_tag_input_history
		C
		ON A.TAG = C.TAG

		<if test="searchCodeArr != null and searchCodeArr != ''">
			WHERE B.ITEM_NAME IN(
			<foreach collection="searchCodeArr" item="searchCodeArr"
				separator=",">
				#{searchCodeArr}
			</foreach>
			)
		</if>
		GROUP BY A.TAG
	</select>
	<!-- -->

	<select id="addChkRow"
		parameterType="com.example.demo.dto.tagSearchVO">
		SELECT A.TAG,
		B.COMPANY_ID,
		B.ITEM_NAME
		FROM
		tb_tag_current_location A
		LEFT JOIN tb_item_info B
		ON A.TAG = B.TAG
		LEFT JOIN tb_tag_input_history
		C
		ON A.TAG = C.TAG

		<if test="searchCodeArr != null and searchCodeArr != ''">
			WHERE B.ITEM_NAME IN(
			<foreach collection="searchCodeArr" item="searchCodeArr"
				separator=",">
				#{searchCodeArr}
			</foreach>
			)
		</if>
		GROUP BY A.TAG
	</select>

</mapper>
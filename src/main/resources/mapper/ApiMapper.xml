<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.ApiDao">

	<select id="getDeviceList"
		resultType="com.example.demo.dto.ApiVO">

		SELECT
		DEVICE_ID,
		DEVICE_NAME
		FROM
		tb_device_info;

	</select>

	<insert id="saveDevice"
		parameterType="com.example.demo.dto.ApiVO">

		INSERT INTO tb_device_info(
		DEVICE_ID,
		COL_NUM,
		ROW_NUM,
		DEVICE_NAME

		)VALUES (
		#{deviceId, jdbcType=VARCHAR},
		#{colNum, jdbcType=INTEGER},
		#{rowNum,
		jdbcType=INTEGER},
		#{deviceName, jdbcType=VARCHAR}
		)
	</insert>

	<update id="updateDevice"
		parameterType="com.example.demo.dto.ApiVO">

		UPDATE tb_device_info
		SET
		DEVICE_NAME = #{updateDevName, jdbcType=VARCHAR}
		WHERE
		DEVICE_ID = {deviceId};

	</update>

	<delete id="delDevice"
		parameterType="com.example.demo.dto.ApiVO">

		DELETE FROM tb_device_info
		WHERE
		DEVICE_ID = {deviceId};

		<!-- 보류 -->

	</delete>

	<select id="currentCount"
		resultType="com.example.demo.dto.ApiVO">

		SELECT
		LOCATION,
		COUNT
		FROM
		tb_device_current_count
		WHERE
		DEVICE_ID = #{deviceId};

	</select>

	<select id="searchCode" resultType="com.example.demo.dto.ApiVO">

		SELECT A.TAG,
		B.ITEM_NAME,
		C.DATE_TIME
		AS INPUT_DATE_TIME
		FROM
		tb_tag_current_location A
		LEFT
		JOIN
		tb_item_info B
		ON A.TAG = B.TAG
		LEFT
		JOIN tb_tag_input_history C
		ON A.TAG
		= C.TAG
		WHERE B.ITEM_CODE = #{itemCode}
		ORDER BY
		C.DATE_TIME DESC LIMIT
		1;

	</select>

	<select id="getCheckRowTag"
		resultType="com.example.demo.dto.ApiVO">
		SELECT
		A.TAG,
		B.ITEM_NAME,
		C.DATE_TIME
		AS INPUT_TAG_TIME
		FROM
		tb_tag_current_location A
		LEFT
		JOIN tb_item_info B
		ON A.TAG = B.TAG
		LEFT
		JOIN tb_tag_input_history C
		ON A.TAG = C.TAG
		<if test="chkRowTagArr != null and chkRowTagArr != ''">
			WHERE A.TAG IN(
			<foreach collection="chkRowTagArr" item="chkRowTagArr"
				separator=",">
				#{chkRowTagArr}
			</foreach>
			)
		</if>
		ORDER BY
		C.DATE_TIME DESC LIMIT 1
	</select>


<!-- 여기부터 고쳐야됨 -->
	<select id="getItemSearch"
		resultType="com.example.demo.dto.ApiVO">
		SELECT A.TAG,
		B.COMPANY_ID,
		B.ITEM_NAME
		FROM
		tb_tag_current_location A
		LEFT JOIN tb_item_info B
		ON A.TAG = B.TAG
		LEFT JOIN tb_tag_input_history
		C
		ON A.TAG = C.TAG

		<if test="searchCodeArr != null and searchCodeArr != ''">
			WHERE B.ITEM_NAME IN(
			<foreach collection="searchCodeArr" item="searchCodeArr"
				separator=",">
				#{searchCodeArr}
			</foreach>
			)
		</if>
		GROUP BY A.TAG
	</select>


</mapper>
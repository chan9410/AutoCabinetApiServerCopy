<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.TagCountDao">


	<select id="getCurrentCount"
		resultType="com.example.demo.dto.tagCountVO">

		SELECT LOCATION, COUNT FROM
		tb_device_current_count WHERE
		DEVICE_ID = "ARM2000";

	</select>

	<select id="getPortNo"
		resultType="com.example.demo.dto.tagCountVO">

		SELECT
		A.TAG
		FROM tb_tag_current_location A
		WHERE A.LOCATION =
		#{location};

	</select>

	<select id="getCodeSearch"
		resultType="com.example.demo.dto.tagSearchVO">
		
		SELECT A.TAG,
		B.COMPANY_ID,
		B.ITEM_NAME,
		C.TAG_TIME
		AS INPUT_TAG_TIME
		FROM
		tb_tag_current_location A
		LEFT
		JOIN tb_item_info B
		ON A.TAG = B.TAG
		LEFT
		JOIN tb_tag_input_history C
		ON A.TAG = C.TAG
		WHERE B.ITEM_NAME = #{searchCode}
		GROUP BY A.TAG
	</select>

	<select id="getItemSearch"
		resultType="com.example.demo.dto.tagSearchVO">
		SELECT A.TAG,
		B.COMPANY_ID,
		B.ITEM_NAME
		FROM
		tb_tag_current_location A
		LEFT JOIN tb_item_info B
		ON A.TAG = B.TAG
		LEFT JOIN tb_tag_input_history C
		ON A.TAG = C.TAG
		
		<if test="searchCodeArr != null and searchCodeArr != ''">
			WHERE B.ITEM_NAME IN(
			<foreach collection="searchCodeArr" item="searchCodeArr"
				separator=",">
				#{searchCodeArr}
			</foreach>
			)
		</if>
		<if test="inputStartDate != null and inputStartDate != ''">
			AND C.TAG_TIME BETWEEN #{inputStartDate} AND
			#{inputLastDate}
		</if>
		GROUP BY A.TAG
	</select>

	<select id="getCheckRowTag"
		resultType="com.example.demo.dto.tagSearchVO">
		SELECT
		A.TAG,
		B.COMPANY_ID,
		B.ITEM_NAME,
		C.TAG_TIME
		AS INPUT_TAG_TIME
		FROM
		tb_tag_current_location A
		LEFT
		JOIN tb_item_info B
		ON A.TAG = B.TAG
		LEFT
		JOIN tb_tag_input_history C
		ON A.TAG = C.TAG
		<if test="chkRowTagArr != null and chkRowTagArr != ''">
			WHERE A.TAG IN(
			<foreach collection="chkRowTagArr" item="chkRowTagArr"
				separator=",">
				#{chkRowTagArr}
			</foreach>
			)
		</if>
		GROUP BY A.TAG
	</select>

	<select id="getSelectCabinet"
		resultType="com.example.demo.dto.tagSearchVO">
		SELECT
		TAG,
		LOCATION
		FROM
		tb_tag_current_location
		<if test="sendData != null and sendData != ''">
			WHERE TAG IN(
			<foreach collection="sendData" item="sendData" separator=",">
				#{sendData}
			</foreach>
			)
		</if>
	</select>

	<select id="getInputHistory"
		resultType="com.example.demo.dto.tagCountVO">
		SELECT A.TAG,
		A.LOCATION,
		A.TAG_TIME,
		B.ITEM_NAME,
		C.WORKER_NAME
		FROM
		tb_tag_input_history A
		LEFT JOIN tb_item_info B
		ON A.TAG = B.TAG
		LEFT JOIN tb_worker C
		ON A.WORKER_ID = C.WORKER_ID
		WHERE
		A.DEVICE_ID = "ARM2000"
		ORDER BY
		A.TAG_TIME DESC LIMIT 30
	</select>

	<select id="getOutputHistory"
		resultType="com.example.demo.dto.tagCountVO">
		SELECT A.TAG,
		A.LOCATION,
		A.TAG_TIME,
		B.ITEM_NAME,
		C.WORKER_NAME
		FROM
		tb_tag_output_history A
		LEFT JOIN tb_item_info B
		ON A.TAG = B.TAG
		LEFT JOIN tb_worker C
		ON A.WORKER_ID = C.WORKER_ID
		WHERE
		A.DEVICE_ID = "ARM2000"
		ORDER BY
		A.TAG_TIME DESC LIMIT 30
	</select>

</mapper>